<div class="overlay" *ngIf="visible">
  <div class="dialog">
    <div class="dialog-header">
      <mat-icon class="header-icon">add_circle</mat-icon>
      <h2 class="dialog-title">{{ data ? 'Editar Ingrediente' : 'Agregar Ingrediente' }}</h2>
      <button mat-icon-button class="close-button" (click)="onCancel()">
        <mat-icon>close</mat-icon>
      </button>
    </div>

    <mat-divider></mat-divider>

    <form [formGroup]="form" (ngSubmit)="onSave()" class="dialog-form">
      <mat-form-field appearance="outline" class="form-field">
        <mat-label>Nombre del ingrediente</mat-label>
        <input matInput formControlName="nombre" placeholder="Ej: Tomate, Harina, Azúcar" />
        <mat-error *ngIf="f['nombre'].touched && f['nombre'].invalid">
          El nombre es obligatorio
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="form-field">
        <mat-label>Unidad de medida</mat-label>
        <mat-select formControlName="unidad">
          <mat-option value="KILOGRAM">Kilogramo (kg)</mat-option>
          <mat-option value="LITER">Litro (L)</mat-option>
          <mat-option value="PIECE">Unidad (pza)</mat-option>
          <mat-option value="GRAM">Gramo (g)</mat-option>
          <mat-option value="MILLILITER">Mililitro (ml)</mat-option>
        </mat-select>
        <mat-error *ngIf="f['unidad'].touched && f['unidad'].invalid">
          Debe seleccionar una unidad
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="form-field">
        <mat-label>Valor por unidad</mat-label>
        <input matInput type="number" formControlName="valor" placeholder="0.00" />
        <span matPrefix>$&nbsp;</span>
        <mat-error *ngIf="f['valor'].touched && f['valor'].errors?.['required']">
          El valor es obligatorio
        </mat-error>
        <mat-error *ngIf="f['valor'].errors?.['min']">
          El valor debe ser mayor o igual a 0
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="form-field">
        <mat-label>URL de imagen (opcional)</mat-label>
        <input matInput formControlName="imagen" placeholder="https://ejemplo.com/imagen.jpg" />
        <mat-icon matSuffix>image</mat-icon>
        <mat-error *ngIf="f['imagen'].touched && f['imagen'].errors?.['formatoInvalido']">
          Solo se permiten imágenes .jpg, .jpeg o .png
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="form-field">
        <mat-label>Sitio de compra</mat-label>
        <input matInput formControlName="sitioCompra" placeholder="Ej: Supermercado, Tienda local" />
        <mat-icon matSuffix>store</mat-icon>
        <mat-error *ngIf="f['sitioCompra'].touched && f['sitioCompra'].invalid">
          El sitio de compra es obligatorio
        </mat-error>
      </mat-form-field>

      <div class="dialog-actions">
        <button mat-button type="button" (click)="onCancel()" class="cancel-button">
          <mat-icon>cancel</mat-icon>
          Cancelar
        </button>
        <button mat-raised-button color="primary" type="submit" [disabled]="form.invalid" class="save-button">
          <mat-icon>save</mat-icon>
          {{ data ? 'Actualizar' : 'Guardar' }}
        </button>
      </div>
    </form>
  </div>
</div>
